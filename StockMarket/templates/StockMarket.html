{% extends "home.html" %}
{% block content %}
{% load crispy_forms_tags %}
<div class="container">
    <h1>Stocks</h1>
    <form method="post" action="{% url 'StockMarket' %}">
        {% csrf_token %}
        <input class="form-control me-2" type="search" placeholder="Search Stock" name="search" id="search">
        <button class="btn btn-outline-secondary" type="submit">Search</button>
    </form>
    <div class="content" id="content">
    {% for stock in Stocks %}
        <div class="single_content border border-success mt-2 pl-2">
        <h3>{{stock.title}}</h3>
        <p>{{stock.desc}}</p>
        </div>
    {% endfor %}
    </div>
    <div class="load-more__btn mt-3" id="btn">
        <button type="button" class="btn btn-success" onclick="loadmorestock()">Load More stock</button>
    </div>
    <div class="alert alert-danger mt-2 not-visible" role="alert" id='alert'>
    No more stocks to load!!
    </div>
</div>
 {{total_obj|json_script:"json-total"}}
<script>
const loadBtn = document.getElementById('btn');
const total = JSON.parse(document.getElementById('json-total').textContent);
const alert = document.getElementById('alert');
const search = document.getElementById('search');
var _current_item = $('.single_content').length


function loadmorestock() {
    var _current_item = $('.single_content').length
    const content_container = document.getElementById("content");
    $.ajax({
        url: '{% url "load" %}',
        type: 'GET',
        data: {'loaded_item': _current_item},
        success: function (response) {
            const data = response.Stocks
            data.map(stock => {
                console.log(stock.title);
                content_container.innerHTML += `<div class="single_content border border-success mt-2 pl-2">
                                                    <h3>${stock.title}</h3>
                                                    <p>${stock.desc}</p>
                                                </div>`})
            if (_current_item == total) {
                alert.classList.remove('not-visible');
                loadBtn.classList.add('not-visible'); }
            }
    });
}
if (_current_item == total){
alert.classList.remove('not-visible');
loadBtn.classList.add('not-visible');
}
</script>

{% endblock %}